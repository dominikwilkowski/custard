/***************************************************************************************************************************************************************
 *
 * Testing server
 *
 **************************************************************************************************************************************************************/

'use strict';

//--------------------------------------------------------------------------------------------------------------------------------------------------------------
// Dependencies
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
var Fs = require('fs');


var Custard = (function Application() {

	return {
		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		// Settings
		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		QUEUE: 0,

		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		// Running a new request
		//
		// @param  targets   [function]   The function to be run
		//
		// @return           [string]     ID of the function run
		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		run: function Running( targets ) {
			Custard.QUEUE ++;

			targets.forEach(function iterateArguments( bit ) {
				console.log('iteration');
				//error handling
				if( typeof bit.run !== 'function' ) {
					console.log('Error dude!: ' + typeof bit.run);

					return;
				}

				if( typeof bit.priority !== 'number' ) {
					if( typeof bit.priority !== 'undefined' ) {
						bit.priority = 0;
					}
					else {
						console.log('Error dude!: ' + typeof bit.priority);
						return;
					}
				}

				var myObjAsync = promisify( bit.run );

				myObjAsync().then(function(data) {
					console.log("%j", data);
					console.log('???');
					return data;
				});

				// PW( bit.run ).then(function( data ) {
				// 	console.log('done');
				// }).error(function( err ) {
				// 	console.log('ERROR!');
				// });

				console.log('end!');
			});
		},


		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		// Finishing a queue element
		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		finish: function Finishing() {
			Custard.QUEUE --;

			var ID = title;

			console.log( 'End! ' + ID );
		},
	};
}());


//--------------------------------------------------------------------------------------------------------------------------------------------------------------
// Module export
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
module.exports = Custard;